<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="PortSwigger Labs - Business logic - Missing validation of negative quantities" /><meta property="og:locale" content="en" /><meta name="description" content="Description Link: https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-high-level" /><meta property="og:description" content="Description Link: https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-high-level" /><link rel="canonical" href="https://martinotommasini.github.io/posts/Business-logic-negative-quantities/" /><meta property="og:url" content="https://martinotommasini.github.io/posts/Business-logic-negative-quantities/" /><meta property="og:site_name" content="Martino Tommasini" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-14T21:12:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PortSwigger Labs - Business logic - Missing validation of negative quantities" /><meta name="twitter:site" content="@tomatop_sec" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Description Link: https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-high-level","url":"https://martinotommasini.github.io/posts/Business-logic-negative-quantities/","@type":"BlogPosting","headline":"PortSwigger Labs - Business logic - Missing validation of negative quantities","dateModified":"2021-07-14T21:12:00+02:00","datePublished":"2021-07-14T21:12:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://martinotommasini.github.io/posts/Business-logic-negative-quantities/"},"@context":"https://schema.org"}</script><title>PortSwigger Labs - Business logic - Missing validation of negative quantities | Martino Tommasini</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Martino Tommasini"><meta name="application-name" content="Martino Tommasini"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Martino Tommasini</a></div><div class="site-subtitle font-italic">InfoSec student | CTF player | Aspiring Penetration Tester</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/MartinoTommasini" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/tomatop_sec" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['martino.tommasini','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>PortSwigger Labs - Business logic - Missing validation of negative quantities</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>PortSwigger Labs - Business logic - Missing validation of negative quantities</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Martino Tommasini </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 14, 2021, 9:12 PM +0200" >Jul 14<i class="unloaded">2021-07-14T21:12:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="166 words">1 min read</span></div></div><div class="post-content"><h2 id="description">Description</h2><p>Link: https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-high-level</p><blockquote><p><img data-proofer-ignore data-src="/assets/img/PortSwigger/Business-logic-negative-quantities/2021-07-14-19-42-49.png" alt="" class="shadow" /></p></blockquote><h2 id="writeup">Writeup</h2><p>We move through the website while recording the HTTP traffic using Burp.</p><p>When an item is added to the cart, the request looks like this one:</p><blockquote><p><img data-proofer-ignore data-src="/assets/img/PortSwigger/Business-logic-negative-quantities/2021-07-14-19-54-05.png" alt="" class="shadow" /></p></blockquote><p>The item’s <strong>productID</strong> and <strong>quantity</strong> are specified in the POST body and sent to the server (The <code class="language-plaintext highlighter-rouge">productId=1</code> represents our <code class="language-plaintext highlighter-rouge">Lightweight l33t leather jacket</code>).</p><p>We change the <strong>quantity</strong> to -100. Since quantity is not properly validated, our cart will have a negative value. trying to place the order for that cart, we get an error:</p><blockquote><p><img data-proofer-ignore data-src="/assets/img/PortSwigger/Business-logic-negative-quantities/2021-07-14-20-02-19.png" alt="" class="shadow" /></p></blockquote><p>The server checks for the cart’s total and throws an error if the quantity is negative.<br /> However, since we can add negative quantities for items, we can use them to make the cart’s value lower (while keeping it positive). In this way we are able to afford our dream jacket.</p><blockquote><p><img data-proofer-ignore data-src="/assets/img/PortSwigger/Business-logic-negative-quantities/2021-07-14-20-09-54.png" alt="" class="shadow" /></p></blockquote><p>Placing the order, we manage to buy a 1337 dollar jacket for 33.11 dollars (we could lower the price up to 0.01 if we really want to save money :) )</p><blockquote><p><img data-proofer-ignore data-src="/assets/img/PortSwigger/Business-logic-negative-quantities/2021-07-14-20-12-05.png" alt="" class="shadow" /></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/portswigger-labs/'>PortSwigger-Labs</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/business-logic/" class="post-tag no-text-decoration" >business-logic</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PortSwigger Labs - Business logic - Missing validation of negative quantities - Martino Tommasini&url=https://martinotommasini.github.io/posts/Business-logic-negative-quantities/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PortSwigger Labs - Business logic - Missing validation of negative quantities - Martino Tommasini&u=https://martinotommasini.github.io/posts/Business-logic-negative-quantities/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=PortSwigger Labs - Business logic - Missing validation of negative quantities - Martino Tommasini&url=https://martinotommasini.github.io/posts/Business-logic-negative-quantities/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Schooled/">Hack The Box - Schooled writeup</a><li><a href="/posts/TheNotebook/">Hack The Box - TheNotebook writeup</a><li><a href="/posts/Armageddon/">Hack The Box - Armageddon writeup</a><li><a href="/posts/Love/">Hack The Box - Love writeup</a><li><a href="/posts/ScriptKiddie/">Hack The Box - ScriptKiddie Writeup</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/known-exploit/">known-exploit</a> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/reflected-xss/">reflected-xss</a> <a class="post-tag" href="/tags/stored-xss/">stored-xss</a> <a class="post-tag" href="/tags/broken-access-control/">broken-access-control</a> <a class="post-tag" href="/tags/business-logic/">business-logic</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Business-logic-trust-client-side-controls/"><div class="card-body"> <span class="timeago small" >Jul 14<i class="unloaded">2021-07-14T19:09:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PortSwigger Labs - Business Logic - Excessive trust in client side controls</h3><div class="text-muted small"><p> Description Link: https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-excessive-trust-in-client-side-controls Writeup Goal of the challenge is to buy a Lightweight l3...</p></div></div></a></div><div class="card"> <a href="/posts/XXE-to-SSRF/"><div class="card-body"> <span class="timeago small" >Jul 13<i class="unloaded">2021-07-13T20:02:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PortSwigger Labs - XXE to SSRF to exfiltrate EC2 instance metadata</h3><div class="text-muted small"><p> Description Link: https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-perform-ssrf Writeup We can modify the XML sent to the server in the check stock feature and see what happe...</p></div></div></a></div><div class="card"> <a href="/posts/Reflected-XSS-on-custom-tag/"><div class="card-body"> <span class="timeago small" >Jun 23<i class="unloaded">2021-06-23T10:40:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PortSwigger Labs - Reflected XSS into HTML context with all tags blocked except custom ones</h3><div class="text-muted small"><p> Reflected XSS into HTML context with all tags blocked except custom ones Description Link: https://portswigger.net/web-security/cross-site-scripting/contexts/lab-html-context-with-all-standard-ta...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Business-logic-trust-client-side-controls/" class="btn btn-outline-primary" prompt="Older"><p>PortSwigger Labs - Business Logic - Excessive trust in client side controls</p></a> <a href="/posts/Micro-CMS-v1/" class="btn btn-outline-primary" prompt="Newer"><p>Hacker101 - Micro-CMS v1 writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/tomatop_sec">Martino Tommasini</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/known-exploit/">known exploit</a> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/reflected-xss/">reflected xss</a> <a class="post-tag" href="/tags/stored-xss/">stored xss</a> <a class="post-tag" href="/tags/broken-access-control/">broken access control</a> <a class="post-tag" href="/tags/business-logic/">business logic</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://martinotommasini.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
